steps:
  - name: gcr.io/cloud-builders/docker
    args:
      - build
      - '--build-arg'
      - TAG_NAME=$TAG_NAME
      - '-t'
      - gcr.io/platformer-november/cicd-one:$TAG_NAME
      - '-f'
      - Dockerfile
      - .
  - name: gcr.io/cloud-builders/curl
    entrypoint: curl
    args:
      - '--header'
      - 'x-organization-id: 23f638a9-2769-4632-a7b2-cfbc558d06cf'
      - '--header'
      - 'x-project-id: 036a5e4d-4268-4c38-ad9f-c937376cfb6b'
      - '-d'
      - '{ "channel": "default",  "update_type": "patch", "container_id": "732ec3d1-8e78-4f6d-9c33-34b80335aea5",  "image_name_with_tag": "gcr.io/platformer-november/cicd-one:$TAG_NAME"}'
      - '-X'
      - POST
      - https://beta.api.platformer.com/rudder/webhook/v1/container?token=${_PLATFORMER_AUTOGENERATED_CICD}
images:
  - gcr.io/platformer-november/cicd-one:$TAG_NAME
